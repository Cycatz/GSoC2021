* GSoC'21: Input method in FreeBSD virtual terminal
** Screenshot 
[[file:assets/vt_ime_screenshot.png]]

** Proposal 
Under the ~proposal~ directory. 

** Wiki Page
The project page in the freebsd wiki: https://wiki.freebsd.org/SummerOfCode2021Projects/InputMethodInFreeBSDVirtualTerminal

The wiki page also contains my weekly reports during GSoC.  

** Description

This project aims to provide an environment that can run IME (input method engine) to enable users to type CJK characters in ~vt(4)~.

This project was divided into two parts, backend and frontend. The backend is supposed to process keys sent from the frontend and translate them into valid CJK characters, depending on different input schemas. The frontend, on the other hand, recieves utf-8 encoded CJK characters and insert them on the screen. Additionally, the frontend need to print preedit string and candidates during composing.

** Deliverables
 + *Backend*: An IME API server for communicating with the IME library
   * Use ~librime~ as the input method engine library to translate keys into valid CJK characters.
   * Create APIs for accessing the IME library functions.
   * Provide extra features like schema selection, data deployment and data synchronization. 
 + *Frontend*: A graphical frontend for showing the current input status and characters/words candidates.  
   + First stage: Implement the frontend in ~tmux~. 
     + Design an IME client for interacting with the backend IME API server.
     + Display IME components on the ~tmux~ status bar.
   + Final stage: Implement the frontend in ~vt(4)~. 
     + Handle keys in kernel and send them to the backend.
     + Display IME components on the screen.

** Report
Under the ~report~ directory. 

** Paper
[[https://papers.freebsd.org/2023/asiabsdcon/fan-VT_IME_Input_Method_Editor_in_FreeBSD_vt_4.files/fan-VT_IME_Input_Method_Editor_in_FreeBSD_vt_4.pdf][Project whitepaper]]

** Code
+ Tmux-rime: https://github.com/Cycatz/tmux-rime
+ Cloned source code:
  + Branch ~vt-ime~: https://github.com/Cycatz/freebsd-src/tree/vt-ime
  + Branch ~vt-ime-13.0~ (Branching from ~releng/13.0~): https://github.com/Cycatz/freebsd-src/tree/vt-ime-13.0
  + A single patch: https://github.com/Cycatz/freebsd-src/commit/32d4627e00157a84677afe00dfdfd1d051c7db38.patch

** Notes
+ Project notes: https://gitlab.com/Cycatz/gsoc-notes 

** Usage 
1. Set up the kernel patch (branch ~vt-ime~): https://github.com/Cycatz/freebsd-src/tree/vt-ime
2. Set up the backend:  https://github.com/Cycatz/tmux-rime/blob/vt-rime/README.org
3. Fire up the ~vt~ console and set the console font to ~b16.hex~ in [[https://github.com/emaste/fontstuff][fontstuff]] for displaying CJK characters correctly
4. Press right ctrl key to toggle IME mode
5. Press keys to compose CJK chars/words and use ~Space~ to commit the preedit string (Currently only support the input scheme /bopomofo/)

